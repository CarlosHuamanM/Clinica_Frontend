<!-- Paneles de métricas -->
<div class="row gy-4 mb-5">
    <div class="col-md-6">
        <div class="bg-info text-white p-4 rounded text-center">
            <h2>Cantidad de citas</h2>
            <form [formGroup]="formCitasPorSexo">
                <label for="startDate">Desde</label>
                <input type="date" class="form-control" id="startDate" name="startDate" formControlName="startDate"
                    [class]="{'is-invalid': formCitasPorSexo.get('startDate')?.invalid && formCitasPorSexo.get('startDate')?.touched}"
                    (change)="loadChartDataCitasPorSexo(formCitasPorSexo.get('startDate')?.value ?? '2024-11-01', formCitasPorSexo.get('endDate')?.value ?? '2024-12-12')">
                <label for="endDate">Hasta</label>
                <input type="date" class="form-control" id="endDate" name="endDate" formControlName="endDate"
                    [class]="{'is-invalid': formCitasPorSexo.get('endDate')?.invalid && formCitasPorSexo.get('endDate')?.touched}"
                    (change)="loadChartDataCitasPorSexo(formCitasPorSexo.get('startDate')?.value ?? '2024-11-01', formCitasPorSexo.get('endDate')?.value ?? '2024-12-12')">
            </form>
            <button class="btn btn-primary w-100 mt-2"
                (click)="downloadReportCitasPorSexo(formCitasPorSexo.get('startDate')?.value ?? '2024-11-01', formCitasPorSexo.get('endDate')?.value ?? '2024-12-12')"><i
                    class="bi bi-box-arrow-in-down"></i></button>
            <app-chart [type]="'bar'" [data]="dataCitasPorSexo" [options]="optionsCitasPorSexo"></app-chart>
        </div>
    </div>

    <div class="col-md-6">
        <div class="bg-info text-white p-4 rounded text-center">
            <h2>Citas por tipo de tratamiento</h2>
            <form [formGroup]="formCitasPorSexo">
                <label for="startDate">Desde</label>
                <input type="date" class="form-control" id="startDate" name="startDate" formControlName="startDate"
                    [class]="{'is-invalid': formCitasPorSexo.get('startDate')?.invalid && formCitasPorSexo.get('startDate')?.touched}"
                    (change)="loadChartDataCitasPorTipoTratamiento(formCitasPorTipoTratamiento.get('startDate')?.value ?? '2024-11-01', formCitasPorTipoTratamiento.get('endDate')?.value ?? '2024-12-12')">
                <label for="endDate">Hasta</label>
                <input type="date" class="form-control" id="endDate" name="endDate" formControlName="endDate"
                    [class]="{'is-invalid': formCitasPorSexo.get('endDate')?.invalid && formCitasPorSexo.get('endDate')?.touched}"
                    (change)="loadChartDataCitasPorTipoTratamiento(formCitasPorTipoTratamiento.get('startDate')?.value ?? '2024-11-01', formCitasPorTipoTratamiento.get('endDate')?.value ?? '2024-12-12')">
            </form>
            <button class="btn btn-primary w-100 mt-2"
                (click)="downloadReportCitasPorTipo(formCitasPorSexo.get('startDate')?.value ?? '2024-11-01', formCitasPorSexo.get('endDate')?.value ?? '2024-12-12')"><i
                    class="bi bi-box-arrow-in-down"></i></button>
            <app-chart [type]="'bar'" [data]="dataCitasPorTipoTratamiento"
                [options]="optionsCitasPorTipoTratamiento"></app-chart>
        </div>
    </div>

    <div class="col-md-6">
        <div class="bg-primary text-white p-4 rounded text-center">
            <h2 class="text-dark">Citas por estado</h2>
            <form [formGroup]="formCitasCanceladas">
                <label for="startDate">Desde</label>
                <input type="date" class="form-control" id="startDate" name="startDate" formControlName="startDate"
                    [class]="{'is-invalid': formCitasCanceladas.get('startDate')?.invalid && formCitasCanceladas.get('startDate')?.touched}"
                    (change)="loadChartDataCitasCanceladas(formCitasCanceladas.get('startDate')?.value ?? '2024-11-01', formCitasCanceladas.get('endDate')?.value ?? '2024-12-12')">
                <label for="endDate">Hasta</label>
                <input type="date" class="form-control" id="endDate" name="endDate" formControlName="endDate"
                    [class]="{'is-invalid': formCitasCanceladas.get('endDate')?.invalid && formCitasCanceladas.get('endDate')?.touched}"
                    (change)="loadChartDataCitasCanceladas(formCitasCanceladas.get('startDate')?.value ?? '2024-11-01', formCitasCanceladas.get('endDate')?.value ?? '2024-12-12')">
            </form>
            <button class="btn btn-primary w-100 mt-2"
                (click)="downloadReportCitasCanceladas(formCitasPorSexo.get('startDate')?.value ?? '2024-11-01', formCitasPorSexo.get('endDate')?.value ?? '2024-12-12')"><i
                    class="bi bi-box-arrow-in-down"></i></button>
            <app-chart [type]="'bar'" [data]="dataCitasCanceladas" [options]="optionsCitasCanceladas"></app-chart>
        </div>
    </div>
    <div class="col-md-6">
        <div class="bg-primary text-white p-4 rounded text-center">
            <h2 class="text-dark">Numero de citas por dentista</h2>
            <form [formGroup]="formCitasPorDentista">
                <label for="startDate">Desde</label>
                <input type="date" class="form-control" id="startDate" name="startDate" formControlName="startDate"
                    [class]="{'is-invalid': formCitasPorDentista.get('startDate')?.invalid && formCitasPorDentista.get('startDate')?.touched}"
                    (change)="loadDataCitasPorDentista(formCitasPorDentista.get('startDate')?.value ?? '2024-11-01', formCitasPorDentista.get('endDate')?.value ?? '2024-12-12', formCitasPorDentista.get('estado')?.value ?? 'Pendiente')">
                <label for="endDate">Hasta</label>
                <input type="date" class="form-control" id="endDate" name="endDate" formControlName="endDate"
                    [class]="{'is-invalid': formCitasPorDentista.get('endDate')?.invalid && formCitasPorDentista.get('endDate')?.touched}"
                    (change)="loadDataCitasPorDentista(formCitasPorDentista.get('startDate')?.value ?? '2024-11-01', formCitasPorDentista.get('endDate')?.value ?? '2024-12-12', formCitasPorDentista.get('estado')?.value ?? 'Pendiente')">
                <label for="estado">Estado</label>
                <select class="form-select" id="estado" name="estado" formControlName="estado"
                    (change)="loadDataCitasPorDentista(formCitasPorDentista.get('startDate')?.value ?? '2024-11-01', formCitasPorDentista.get('endDate')?.value ?? '2024-12-12', formCitasPorDentista.get('estado')?.value ?? 'Pendiente')">
                    <option value="Pendiente">Pendiente</option>
                    <option value="Atendida">Atendida</option>
                    <option value="Cancelada">Cancelada</option>
                </select>
            </form>
            <button class="btn btn-primary w-100 mt-2"
                (click)="downloadReportCitasPorDentista(formCitasPorDentista.get('startDate')?.value ?? '2024-11-01', formCitasPorDentista.get('endDate')?.value ?? '2024-12-12', formCitasPorDentista.get('estado')?.value ?? 'Pendiente')"><i
                    class="bi bi-box-arrow-in-down"></i></button>
            <table class="table table-striped table-bordered mt-2">
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>Nombres</th>
                        <th>N° de colegiatura</th>
                        <th>#de citas</th>
                    </tr>
                </thead>
                <tbody>
                    @for (item of dataCitasPorDentista | async; track $index) {
                    <tr>
                        <td>{{item.dentistaId}}</td>
                        <td>{{item.dentistaNombres}}</td>
                        <td>{{item.dentistaColegiatura}}</td>
                        <td>{{item.total}}</td>
                        }
                </tbody>
            </table>
        </div>
    </div>
</div>
@if (userRole === 'ADMINISTRADOR') {
    <div class="row gy-4 mb-5 bg-dark text-white p-4 rounded text-center">
        <h2>Historial de reportes</h2>
        <table class="table table-striped table-bordered mt-2">
            <thead>
                <tr>
                    <th>Id</th>
                    <th>Fecha y hora</th>
                    <th>Reporte</th>
                    <th>Usuario</th>
                    <th>Tipo de documento</th>
                    <th>Numero de indentidad</th>
            </thead>
            <tbody>
                @for (item of paginatedReports; track $index) {
                <tr>
                    <td>{{item.id}}</td>
                    <td>{{item.fechaCreacion | date: 'dd/MM/yyyy HH:mm'}}</td>
                    <td>{{item.tipoReporte.titulo}}</td>
                    <td>{{item.usuario.nombres}} {{item.usuario.apellidoPaterno}} {{item.usuario.apellidoMaterno}}</td>
                    <td>{{item.usuario.tipoDocumento.nombre}}</td>
                    <td>{{item.usuario.numeroIdentidad}}</td>
                </tr>
                }
        </table>
        <nav>
            <ul class="pagination justify-content-center">
                <li class="page-item" [ngClass]="{ 'disabled': currentPageReport === 1 }">
                    <a class="page-link" (click)="onPageChangeReport(currentPageReport - 1)">&#x276E;</a>
                </li>
                <li class="page-item" *ngFor="let page of [].constructor(totalPagesReport); let i = index">
                    <a class="page-link" [ngClass]="{ 'active': currentPageReport === i + 1 }"
                        (click)="onPageChangeReport(i + 1)">{{ i + 1 }}</a>
                </li>
                <li class="page-item" [ngClass]="{ 'disabled': currentPageReport === totalPagesReport }">
                    <a class="page-link" (click)="onPageChangeReport(currentPageReport + 1)">&#x276F;</a>
                </li>
            </ul>
        </nav>
    </div>
}